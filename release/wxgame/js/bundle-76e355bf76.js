!function(){"use strict";class e{constructor(){}static init(){Laya.ClassUtils.regClass}}e.width=720,e.height=1280,e.scaleMode="fixedwidth",e.screenMode="none",e.alignV="top",e.alignH="left",e.startScene="views/home.scene",e.sceneRoot="",e.debug=!1,e.stat=!1,e.physicsDebug=!1,e.exportSceneToJson=!0,e.init();var a=!1;class t extends Laya.Scene{constructor(){super()}load(){return new Promise((e,a)=>{Laya.Scene.load("views/home.scene",Laya.Handler.create(this,function(a){console.log(a);var t=Laya.stage.addChild(a);this.ProgressBar=t.getChildByName("progressBar"),this.progress=t.getChildByName("progress"),this.startButton=t.getChildByName("start"),e(this.ProgressBar)}))})}}class s extends Laya.Scene{constructor(){super(),this.cameraZ=0,this.buildingIndex=4,this.currentPositionZ=2,this.pools=[],this.lock=!1,this.roleCurrentPosition=0,this.currenMouseX=0,this.currenMouseY=0,this.roleCurrentPositionY=0,this.isReady=!1,this.isDead=a,this.countLoop=1,this.transitionLock=!1,this.initHome()}initHome(){this.home=new t,this.home.load().then(async()=>{console.log(this.home.ProgressBar),this.home.ProgressBar.value=0,await this.loadingAssets(),this.sceneByMemory=Laya.loader.getRes("res/LayaScene_TitleScene/Conventional/TitleScene.ls"),this.home.startButton.visible=!0,this.home.startButton.on(Laya.Event.CLICK,this,this.init)})}async loadingAssets(){return new Promise((e,a)=>{Laya.loader.create(["res/LayaScene_TitleScene/Conventional/TitleScene.ls","res/bgm_Bounce_It.mp3"],Laya.Handler.create(this,function(a){e(a)}),Laya.Handler.create(this,function(e){this.home.ProgressBar.value=e,this.home.progress.text=Math.floor(100*e)+"%",console.log(e)}))})}init(){this.roleCurrentPosition=0,this.roleCurrentPositionY=0,this.cameraZ=0,this.countLoop=1,this.buildingIndex=4,this.currentPositionZ=2,Laya.timer.once(300,this,function(){this.scene3D=Laya.stage.addChild(new Laya.Scene3D),this.camera=this.scene3D.addChild(new Laya.Camera(0,5,120)),this.camera.name="mainCamera",this.camera.transform.translate(new Laya.Vector3(0,5,20)),this.camera.transform.rotate(new Laya.Vector3(0,0,0),!0,!1),this.scene3D.ambientColor=new Laya.Vector3(1,1,1),console.log(this.sceneByMemory),this.Road=this.sceneByMemory.getChildByName("Road").clone(),console.log(this.sceneByMemory,this.Road);var e=this.sceneByMemory.getChildByName("Vampire_No_Animation").clone();this.role=this.scene3D.addChild(e),console.log(this.role),this.role.transform.position=new Laya.Vector3(0,0,10),console.log(this.role);this.role.addComponent(o);this.ani=this.role.getComponent(Laya.Animator),this.ani.getDefaultState().clip.islooping=!0,this.ani.play("Run");for(let e=0;e<5;e++){Laya.Pool.getItemByClass("building",Laya.Sprite3D);Laya.Sprite3D.instantiate(this.Road,this.scene3D,!1,new Laya.Vector3(0,0,-32*e))}for(let e=0;e<35;e++)this.createObstacle(this.sceneByMemory,this.scene3D);Laya.timer.loop(40,this,this.GameLoop),Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.onTouchClick),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.onTouchUP),this.player=Laya.SoundManager.playMusic("res/bgm_Bounce_It.mp3",0,Laya.Handler.create(this,this.onComplete))})}GameLoop(){if(a)this.GameOver();else{if(this.camera.transform.position=new Laya.Vector3(0,5,20-this.countLoop),this.role.transform.position=new Laya.Vector3(this.roleCurrentPosition,this.roleCurrentPositionY,10-this.countLoop),this.countLoop+=.5,this.countLoop-this.cameraZ>=32){this.cameraZ=this.countLoop,this.buildingIndex++;Laya.Pool.getItemByClass("building",Laya.Sprite3D);Laya.Sprite3D.instantiate(this.Road,this.scene3D,!1,new Laya.Vector3(0,0,-32*this.buildingIndex));for(var e=0;e<3;e++)this.createObstacle(this.sceneByMemory,this.scene3D)}this.lock||this.destroyObstacle(this.scene3D,-10-this.countLoop),a&&this.GameOver()}}GameOver(){Laya.timer.clear(this,this.GameLoop),this.ani.play("Dead");var e=new Laya.Button;e.skin="res/ui/restart.png",e.width=282,e.height=131,e.label="重新开始",e.labelSize=24,e.labelColors="#fff",e.pos(Laya.stage.width/2-141,Laya.stage.height/2-65),this.restartButton=Laya.stage.addChild(e),this.restartButton.on(Laya.Event.CLICK,this,()=>{this.restartButton.removeSelf(),a=!1,this.roleCurrentPosition=0,this.ani.play("Run"),Laya.Pool.recoverByClass("building"),this.scene3D.removeSelf(),console.log(this.sceneByMemory),Laya.stage.off(Laya.Event.MOUSE_DOWN,this,this.onTouchClick),Laya.stage.off(Laya.Event.MOUSE_UP,this,this.onTouchUP),this.player.stop()})}onComplete(){console.log("Complete")}onTouchUP(){if(!this.transitionLock&&!a){if(Math.abs(Laya.stage.mouseY-this.currenMouseY)>Math.abs(Laya.stage.mouseX-this.currenMouseX)&&Laya.stage.mouseY<this.currenMouseY)return this.ani.play("JumpUp"),void this.transitionTurn("up");if(this.currenMouseX>Laya.stage.mouseX){if(-1.5===this.roleCurrentPosition)return;this.ani.play("TurnLeft"),this.transitionTurn("left")}else{if(1.5===this.roleCurrentPosition)return;this.ani.play("TurnRight"),this.transitionTurn("right")}}}async transition(e){return new Promise((a,t)=>{Laya.timer.once(20,this,()=>{"right"===e&&(this.roleCurrentPosition+=.3),"left"===e&&(this.roleCurrentPosition-=.3),"up"===e&&(this.roleCurrentPositionY+=.4),"down"===e&&(this.roleCurrentPositionY-=.4),a(this.roleCurrentPosition)})})}async transitionTurn(e){if(!this.transitionLock){this.transitionLock=!0,console.log(this.roleCurrentPosition);for(var a=0;a<5;a++)await this.transition(e);if("up"===e)for(a=0;a<5;a++)this.ani.play("JumpDown"),await this.transition("down");this.ani.play("Run"),this.transitionLock=!1}}onTouchClick(){this.currenMouseY=Laya.stage.mouseY,this.currenMouseX=Laya.stage.mouseX}destroyObstacle(e,a){this.lock=!0;for(var t=0;t<e.numChildren;t++)t>1&&e.getChildAt(t).transform.position.z>a+40&&(console.log("!!!"),e.getChildAt(t).removeSelf(),Laya.Pool.recover("building",e.getChildAt(t)));this.lock=!1}createObstacle(e,a){var t=this.currentPositionZ-20,s=Math.floor(4*Math.random())+1,o=new Laya.Vector3(-1.7,0,t),i=new Laya.Vector3(0,0,t),n=new Laya.Vector3(1.5,0,t),r=e.getChildByName("Coin"),h=e.getChildByName("modelCar"),l=e.getChildByName("Obstacle_Defend_Box");1===s?(h.transform.position=o,r.transform.position=n,l.transform.position=i):2===s?(r.transform.position=o,h.transform.position=n,l.transform.position=i):3===s?(l.transform.position=o,h.transform.position=n,r.transform.position=i):4===s&&(l.transform.position=o,r.transform.position=n,h.transform.position=i),l.transform.localScale=new Laya.Vector3(.009,.009,.009),h.transform.localScale=new Laya.Vector3(.8,.8,.8);Laya.Pool.getItemByClass("building",Laya.Sprite3D),Laya.Pool.getItemByClass("building",Laya.Sprite3D),Laya.Pool.getItemByClass("building",Laya.Sprite3D);Laya.Sprite3D.instantiate(r,a,!1),Laya.Sprite3D.instantiate(h,a,!1),Laya.Sprite3D.instantiate(l,a,!1),this.currentPositionZ=t}}class o extends Laya.Script3D{constructor(){super()}onTriggerEnter(e){console.log(e.owner.name),"Coin"===e.owner.name?(Laya.SoundManager.playSound("res/coin.mp3",1,Laya.Handler.create(this,null)),e.owner.removeSelf()):"modelCar"!==e.owner.name&&"Obstacle_Defend_Box"!==e.owner.name||(Laya.SoundManager.playSound("res/hit.mp3",1,Laya.Handler.create(this,null)),a=!0)}onTriggerExit(e){}}new class{constructor(){if(window.Laya3D?Laya3D.init(e.width,e.height):Laya.init(e.width,e.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=e.scaleMode,Laya.stage.screenMode=Laya.Stage.SCREEN_VERTICAL,Laya.stage.alignV=e.alignV,Laya.stage.alignH=e.alignH,Laya.stage.screenMode=Laya.Stage.SCREEN_VERTICAL,Laya.Browser.height/Laya.Browser.width>1.5){Laya.stage.scaleMode=Laya.Stage.SCALE_FIXED_WIDTH;var a=Laya.Browser.height/Laya.Browser.width,t=Laya.stage.width*a;Laya.stage.y=t/2-Laya.stage.designHeight/2}else{Laya.stage.scaleMode=Laya.Stage.SCALE_FIXED_HEIGHT,a=Laya.Browser.height/Laya.Browser.width;var s=Laya.stage.height/a;Laya.stage.x=s/2-Laya.stage.designWidth/2}Laya.URL.exportSceneToJson=e.exportSceneToJson,(e.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),e.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),e.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version-6d63f2138e.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){new s}}}();